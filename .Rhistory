knitr::opts_chunk$set(echo = TRUE)
library(devtools)
install_github("esm-ispm-unibe-ch/NMAJags")
library(NMAJags)
library(R2jags)
library(netmeta)
library(meta)
library(metafor)
library(readxl)
#get the data and select them
DATA <- read_excel("~/Virginia/NMA insomnia/Insomnia/24.5.MyrtoIncludedAllOutcomesClean.xlsx", na = "NA")
#describe the data
tapply(DATA$N_arm_total_stapf,DATA$Drug_name,sum,na.rm=T)
#describe the data
tapply(DATA$N_arm_total_stapf,DATA$Drug_name,sum,na.rm=T)
print(length(table(DATA$Drug_name)))
print(length(table(DATA$Final_ID_all)))
#prepare the data
DATApairs=pairwise(treat=Drug_name,mean=SleepTimeTotalScaleMean,sd=SleepTimeTotalScaleSD,n=SleepTimeTotalScaleParticipants, data=DATA, studlab = Final_ID_all, sm= "SMD")
#run NMA and create an object called EFF for efficacy   ### gives error because consists of 5 separate sub-networks so run netconnection first
netconnection(treat1,treat2,studlab,data=DATApairs,warn = T)
#remove rows for studies disconnected from main network
DPs <- subset(DATApairs, treat2!="waitlist" & treat2!="artificial juice" & treat2!="sleep hygiene" & treat2!="oxazepam")
#check p-value availability for paired t-test
DPs[,c("studlab","tst_PorF-value","tst_p=0, f=1")][DPs$Crossoverstudy==1,]
#remove crossover studies with paired t-test p-value not available or less than
DPs <- DPs[DPs$studlab!=161 & DPs$studlab!=185,]
#now calculate adjusted SE for remaining crossover studies
DPs$tvalue <- qt(as.numeric(DPs$`tst_PorF-value`), df=DPs$n1-1)
DPs$SDd <- (abs(DPs$TE)*sqrt(DPs$n1)/DPs$tvalue)
DPs$rho <- (DPs$sd1^2 + DPs$sd2^2 - DPs$SDd^2)/2*DPs$sd1*DPs$sd2
DPs[DPs$Crossoverstudy==1,"seTE"] <- sqrt((1/DPs$n1 + abs(DPs$TE)/(2*DPs$n1))*(2-2*DPs$rho))[DPs$Crossoverstudy==1] ### produce NaN; check formula again
sqrt((1/DPs$n1 + abs(DPs$TE)/(2*DPs$n1))*(2-2*DPs$rho))[DPs$Crossoverstudy==1]
sqrt((1/DPs$n1 + abs(DPs$TE)/(2*DPs$n1))*(2-2*DPs$rho))
sqrt((1/DPs$n1 + abs(DPs$TE)/(2*DPs$n1)))[DPs$Crossoverstudy==1]
(2-2*DPs$rho)
sqrt((1/DPs$n1 + DPs$TE/(2*DPs$n1)))[DPs$Crossoverstudy==1]
DPs$rho
(DPs$TE)*sqrt(DPs$n1)/DPs$tvalue
abs(DPs$TE)*sqrt(DPs$n1)/DPs$tvalue
(abs(DPs$TE)*sqrt(DPs$n1))/DPs$tvalue
(DPs$sd1^2 + DPs$sd2^2 - DPs$SDd^2)/2*DPs$sd1*DPs$sd2
knitr::opts_chunk$set(echo = TRUE)
library(devtools)
install_github("esm-ispm-unibe-ch/NMAJags")
library(NMAJags)
library(R2jags)
library(netmeta)
library(meta)
library(metafor)
library(readxl)
#get the data and select them
DATA <- read_excel("~/Virginia/NMA insomnia/Insomnia/24.5.MyrtoIncludedAllOutcomesClean.xlsx", na = "NA")
#prepare the data
DATApairs=pairwise(treat=Drug_name,mean=SleepTimeTotalScaleMean,sd=SleepTimeTotalScaleSD,n=SleepTimeTotalScaleParticipants, data=DATA, studlab = Final_ID_all, sm= "SMD")
#run NMA and create an object called EFF for efficacy   ### gives error because consists of 5 separate sub-networks so run netconnection first
netconnection(treat1,treat2,studlab,data=DATApairs,warn = T)
#remove rows for studies disconnected from main network
DPs <- subset(DATApairs, treat2!="waitlist" & treat2!="artificial juice" & treat2!="sleep hygiene" & treat2!="oxazepam")
#check p-value availability for paired t-test
DPs[,c("studlab","tst_PorF-value","tst_p=0, f=1")][DPs$Crossoverstudy==1,]
#remove crossover studies with paired t-test p-value not available or less than
DPs <- DPs[DPs$studlab!=161 & DPs$studlab!=185,]
#now calculate adjusted SE for remaining crossover studies
DPs$tvalue <- qt(as.numeric(DPs$`tst_PorF-value`), df=DPs$n1-1)
DPs$SDd <- (abs(DPs$TE)*sqrt(DPs$n1)/DPs$tvalue)
DPs$rho <- (DPs$sd1^2 + DPs$sd2^2 - DPs$SDd^2)/2*DPs$sd1*DPs$sd2
DPs[DPs$Crossoverstudy==1,"seTE"] <- sqrt((1/DPs$n1 + abs(DPs$TE)/(2*DPs$n1))*(2-2*DPs$rho))[DPs$Crossoverstudy==1] ### produce NaN; check formula again
View(DATA)
DPs$tvalue
DPs$SDd <- (abs(DPs$mean1-DPs$mean2)*sqrt(DPs$n1)/DPs$tvalue)
DPs$SDd
DPs$SDd <- ((DPs$mean1-DPs$mean2)*sqrt(DPs$n1)/DPs$tvalue)
DPs$SDd
DPs$SDd <- ((DPs$mean2-DPs$mean1)*sqrt(DPs$n1)/DPs$tvalue)
DPs$SDd
View(DATApairs)
DPs$mean2-DPs$mean1
DPs$mean1-DPs$mean2
sqrt((1/DPs$n1 + DPs$TE/(2*DPs$n1))*(2-2*DPs$rho
sqrt((1/DPs$n1 + DPs$TE/(2*DPs$n1))*(2-2*DPs$rho))
DPs$SDd
DPs$tvalue
DPs$mean2-DPs$mean1
DPs$TE
DPs$sd1
DPs$sd2
DPs$rho <- (DPs$sd1^2 + DPs$sd2^2 - DPs$SDd^2)/2*DPs$sd1*DPs$sd2
DPs$rho
sqrt(DPs$n1)/DPs$tvalue)
sqrt(DPs$n1)/DPs$tvalue
DPs$rho <- (DPs$sd1^2 + DPs$sd2^2 - DPs$SDd^2)/(2*DPs$sd1*DPs$sd2)
DPs$rho
DPs[DPs$Crossoverstudy==1,"seTE"] <- sqrt((1/DPs$n1 + DPs$TE/(2*DPs$n1))*(2-2*DPs$rho))[DPs$Crossoverstudy==1] ### produce NaN; check formula again
DPs[DPs$Crossoverstudy==1,"seTE"]
DPs$SEd <- ((DPs$mean2-DPs$mean1)*sqrt(DPs$n1)/DPs$tvalue)
DPs$SDd <- DPs$SEd*sqrt(DPs$n1)
DPs$rho <- (DPs$sd1^2 + DPs$sd2^2 - DPs$SDd^2)/(2*DPs$sd1*DPs$sd2)
DPs$SEd
DPs$SDd
DPs$rho
DPs$SDd <- (DPs$mean2-DPs$mean1)/DPs$tvalue*sqrt(DPs$n1)
DPs$SDd
DPs$SDd <- (DPs$mean2-DPs$mean1)/DPs$tvalue*sqrt(DPs$n1)
DPs$rho <- (DPs$sd1^2 + DPs$sd2^2 - DPs$SDd^2)/(2*DPs$sd1*DPs$sd2)
DPs[DPs$Crossoverstudy==1,"seTE"] <- sqrt((1/DPs$n1 + DPs$TE/(2*DPs$n1))*(2-2*DPs$rho))[DPs$Crossoverstudy==1] ### produce NaN; check formula again
knitr::opts_chunk$set(echo = TRUE)
library(devtools)
install_github("esm-ispm-unibe-ch/NMAJags")
library(NMAJags)
library(R2jags)
library(netmeta)
library(meta)
library(metafor)
library(readxl)
#get the data and select them
DATA <- read_excel("~/Virginia/NMA insomnia/Insomnia/24.5.MyrtoIncludedAllOutcomesClean.xlsx", na = "NA")
#prepare the data
DATApairs=pairwise(treat=Drug_name,mean=SleepTimeTotalScaleMean,sd=SleepTimeTotalScaleSD,n=SleepTimeTotalScaleParticipants, data=DATA, studlab = Final_ID_all, sm= "SMD")
#run NMA and create an object called EFF for efficacy   ### gives error because consists of 5 separate sub-networks so run netconnection first
netconnection(treat1,treat2,studlab,data=DATApairs,warn = T)
#remove rows for studies disconnected from main network
DPs <- subset(DATApairs, treat2!="waitlist" & treat2!="artificial juice" & treat2!="sleep hygiene" & treat2!="oxazepam")
#check p-value availability for paired t-test
DPs[,c("studlab","tst_PorF-value","tst_p=0, f=1")][DPs$Crossoverstudy==1,]
#remove crossover studies with paired t-test p-value not available
DPs <- DPs[DPs$studlab!=161,]
# use threshold value for those with p-value <0.001
DPs[DPs$studlab==185, "tst_PorF-value"] <- 0.00099
#now calculate adjusted SE for remaining crossover studies
DPs$tvalue <- qt(as.numeric(DPs$`tst_PorF-value`), df=DPs$n1-1)
DPs$SDd <- (DPs$mean2-DPs$mean1)/DPs$tvalue*sqrt(DPs$n1)
DPs$rho <- (DPs$sd1^2 + DPs$sd2^2 - DPs$SDd^2)/(2*DPs$sd1*DPs$sd2)
DPs[DPs$Crossoverstudy==1,"seTE"] <- sqrt((1/DPs$n1 + DPs$TE/(2*DPs$n1))*(2-2*DPs$rho))[DPs$Crossoverstudy==1]
EFF<-netmeta(TE,seTE,treat1,treat2,studlab,data=DPs,  sm="SMD",r="pbo",comb.fixed =F, comb.random = T, tol.multiarm = 0.05, details.chkmultiarm = T)
knitr::opts_chunk$set(echo = TRUE)
library(devtools)
install_github("esm-ispm-unibe-ch/NMAJags")
library(NMAJags)
library(R2jags)
library(netmeta)
library(meta)
library(metafor)
library(readxl)
#get the data and select them
DATA <- read_excel("~/Virginia/NMA insomnia/Insomnia/24.5.MyrtoIncludedAllOutcomesClean.xlsx", na = "NA")
#prepare the data
DATApairs=pairwise(treat=Drug_name,mean=SleepTimeTotalScaleMean,sd=SleepTimeTotalScaleSD,n=SleepTimeTotalScaleParticipants, data=DATA, studlab = Final_ID_all, sm= "SMD")
#run NMA and create an object called EFF for efficacy   ### gives error because consists of 5 separate sub-networks so run netconnection first
netconnection(treat1,treat2,studlab,data=DATApairs,warn = T)
#remove rows for studies disconnected from main network
DPs <- subset(DATApairs, treat2!="waitlist" & treat2!="artificial juice" & treat2!="sleep hygiene" & treat2!="oxazepam")
#check p-value availability for paired t-test
DPs[,c("studlab","tst_PorF-value","tst_p=0, f=1")][DPs$Crossoverstudy==1,]
#remove crossover studies with paired t-test p-value not available
DPs <- DPs[DPs$studlab!=161,]
# use threshold value for those with p-value <0.001
DPs[DPs$studlab==185, "tst_PorF-value"] <- 0.00099
#now calculate adjusted SE for remaining crossover studies
DPs$tvalue <- qt(as.numeric(DPs$`tst_PorF-value`), df=DPs$n1-1)
DPs$SDd <- (DPs$mean2-DPs$mean1)/DPs$tvalue*sqrt(DPs$n1)
DPs$rho <- (DPs$sd1^2 + DPs$sd2^2 - DPs$SDd^2)/(2*DPs$sd1*DPs$sd2)
DPs[DPs$Crossoverstudy==1,"seTE"] <- sqrt((1/DPs$n1 + DPs$TE/(2*DPs$n1))*(2-2*DPs$rho))[DPs$Crossoverstudy==1]
EFF<-netmeta(TE,seTE,treat1,treat2,studlab,data=DPs,  sm="SMD",r="pbo",comb.fixed =F, comb.random = T, tol.multiarm = 0.05, details.chkmultiarm = T)
View(DPs)
#now calculate adjusted SE for remaining crossover studies
DPs$tvalue <- abs(qt(as.numeric(DPs$`tst_PorF-value`), df=DPs$n1-1))
View(DPs)
DPs$SDd <- (DPs$mean2-DPs$mean1)/DPs$tvalue*sqrt(DPs$n1)
DPs$rho <- (DPs$sd1^2 + DPs$sd2^2 - DPs$SDd^2)/(2*DPs$sd1*DPs$sd2)
DPs[DPs$Crossoverstudy==1,"seTE"] <- sqrt((1/DPs$n1 + DPs$TE/(2*DPs$n1))*(2-2*DPs$rho))[DPs$Crossoverstudy==1]
EFF<-netmeta(TE,seTE,treat1,treat2,studlab,data=DPs,  sm="SMD",r="pbo",comb.fixed =F, comb.random = T, tol.multiarm = 0.05, details.chkmultiarm = T)
#now calculate adjusted SE for remaining crossover studies
DPs$tvalue <- qt(as.numeric(DPs$`tst_PorF-value`), df=DPs$n1-1)
DPs$SDd <- (DPs$mean2-DPs$mean1)/abs(DPs$tvalue)*sqrt(DPs$n1)
DPs$rho <- (DPs$sd1^2 + DPs$sd2^2 - DPs$SDd^2)/(2*DPs$sd1*DPs$sd2)
View(DPs)
View(DPs)
qt(0.025, 1000)
qt(0.025, 1000, lower.tail = F)
knitr::opts_chunk$set(echo = TRUE)
library(devtools)
install_github("esm-ispm-unibe-ch/NMAJags")
library(NMAJags)
library(R2jags)
library(netmeta)
library(meta)
library(metafor)
library(readxl)
#get the data and select them
DATA <- read_excel("~/Virginia/NMA insomnia/Insomnia/24.5.MyrtoIncludedAllOutcomesClean.xlsx", na = "NA")
#prepare the data
DATApairs=pairwise(treat=Drug_name,mean=SleepTimeTotalScaleMean,sd=SleepTimeTotalScaleSD,n=SleepTimeTotalScaleParticipants, data=DATA, studlab = Final_ID_all, sm= "SMD")
#run NMA and create an object called EFF for efficacy   ### gives error because consists of 5 separate sub-networks so run netconnection first
netconnection(treat1,treat2,studlab,data=DATApairs,warn = T)
#remove rows for studies disconnected from main network
DPs <- subset(DATApairs, treat2!="waitlist" & treat2!="artificial juice" & treat2!="sleep hygiene" & treat2!="oxazepam")
#check p-value availability for paired t-test
DPs[,c("studlab","tst_PorF-value","tst_p=0, f=1")][DPs$Crossoverstudy==1,]
#remove crossover studies with paired t-test p-value not available
DPs <- DPs[DPs$studlab!=161,]
# use threshold value for those with p-value <0.001
DPs[DPs$studlab==185, "tst_PorF-value"] <- 0.00099
#now calculate adjusted SE for remaining crossover studies
DPs$tvalue <- qt(as.numeric(1-DPs$`tst_PorF-value`), df=DPs$n1-1)
#now calculate adjusted SE for remaining crossover studies
DPs$tvalue <- qt(as.numeric(DPs$`tst_PorF-value`), df=DPs$n1-1)
DPs$tvalue
#now calculate adjusted SE for remaining crossover studies
DPs$tvalue <- qt(as.numeric(DPs$`tst_PorF-value`), df=DPs$n1-1, lower.tail = F)
DPs$tvalue
#now calculate adjusted SE for remaining crossover studies
DPs$tvalue <- qt(as.numeric(1 - DPs$`tst_PorF-value`), df=DPs$n1-1)
1 - DPs$`tst_PorF-value
1 - DPs$`tst_PorF-value`
DPs$`tst_PorF-value`
#now calculate adjusted SE for remaining crossover studies
DPs$tvalue <- qt(1-as.numeric(DPs$`tst_PorF-value`), df=DPs$n1-1)
DPs$tvalue
DPs$tvalue <- qt(as.numeric(DPs$`tst_PorF-value`), df=DPs$n1-1, lower.tail = F)
DPs$SDd <- abs((DPs$mean2-DPs$mean1)/DPs$tvalue*sqrt(DPs$n1))
DPs$rho <- (DPs$sd1^2 + DPs$sd2^2 - DPs$SDd^2)/(2*DPs$sd1*DPs$sd2)
DPs[DPs$Crossoverstudy==1,"seTE"] <- sqrt((1/DPs$n1 + DPs$TE/(2*DPs$n1))*(2-2*DPs$rho))[DPs$Crossoverstudy==1]
EFF<-netmeta(TE,seTE,treat1,treat2,studlab,data=DPs,  sm="SMD",r="pbo",comb.fixed =F, comb.random = T, tol.multiarm = 0.05, details.chkmultiarm = T)
knitr::opts_chunk$set(echo = TRUE)
library(devtools)
install_github("esm-ispm-unibe-ch/NMAJags")
library(NMAJags)
library(R2jags)
library(netmeta)
library(meta)
library(metafor)
library(readxl)
#get the data and select them
DATA <- read_excel("~/Virginia/NMA insomnia/Insomnia/24.5.MyrtoIncludedAllOutcomesClean.xlsx", na = "NA")
#prepare the data
DATApairs=pairwise(treat=Drug_name,mean=SleepTimeTotalScaleMean,sd=SleepTimeTotalScaleSD,n=SleepTimeTotalScaleParticipants, data=DATA, studlab = Final_ID_all, sm= "SMD")
#run NMA and create an object called EFF for efficacy   ### gives error because consists of 5 separate sub-networks so run netconnection first
netconnection(treat1,treat2,studlab,data=DATApairs,warn = T)
#remove rows for studies disconnected from main network
DPs <- subset(DATApairs, treat2!="waitlist" & treat2!="artificial juice" & treat2!="sleep hygiene" & treat2!="oxazepam")
#check p-value availability for paired t-test
DPs[,c("studlab","tst_PorF-value","tst_p=0, f=1")][DPs$Crossoverstudy==1,]
#remove crossover studies with paired t-test p-value not available
DPs <- DPs[DPs$studlab!=161,]
# use threshold value for those with p-value <0.001
DPs[DPs$studlab==185, "tst_PorF-value"] <- 0.00099
#now calculate adjusted SE for remaining crossover studies
DPs$tvalue <- qt(as.numeric(DPs$`tst_PorF-value`), df=DPs$n1-1, lower.tail = F)
DPs$SDd <- abs((DPs$mean2-DPs$mean1)/DPs$tvalue*sqrt(DPs$n1))
DPs$rho <- (DPs$sd1^2 + DPs$sd2^2 - DPs$SDd^2)/(2*DPs$sd1*DPs$sd2)
DPs[DPs$Crossoverstudy==1,"seTE"] <- sqrt((1/DPs$n1 + DPs$TE/(2*DPs$n1))*(2-2*DPs$rho))[DPs$Crossoverstudy==1]
DATA[DPs$Crossoverstudy==1,c("SleepTimeTotalScaleMean", "SleepTimeTotalScaleSD","SleepTimeTotalScaleParticipants"]
DATA[DPs$Crossoverstudy==1,c("SleepTimeTotalScaleMean", "SleepTimeTotalScaleSD","SleepTimeTotalScaleParticipants")]
DATA[Crossoverstudy==1,c("SleepTimeTotalScaleMean", "SleepTimeTotalScaleSD","SleepTimeTotalScaleParticipants")]
DATA[DATA$Crossoverstudy==1,c("SleepTimeTotalScaleMean", "SleepTimeTotalScaleSD","SleepTimeTotalScaleParticipants")]
DATA[DATA$Crossoverstudy==1,c("studlab","SleepTimeTotalScaleMean", "SleepTimeTotalScaleSD","SleepTimeTotalScaleParticipants")]
DATA[DATA$Crossoverstudy==1,c("Final_ID_all","SleepTimeTotalScaleMean", "SleepTimeTotalScaleSD","SleepTimeTotalScaleParticipants")]
View(DATA[DATA$Crossoverstudy==1,c("Final_ID_all","SleepTimeTotalScaleMean", "SleepTimeTotalScaleSD","SleepTimeTotalScaleParticipants")])
View(DATA[DATA$Crossoverstudy==1,c("Final_ID_all","SleepTimeTotalScaleMean", "SleepTimeTotalScaleSD","SleepTimeTotalScaleParticipants","tst_PorF-value","tst_p=0, f=1")])
View(DPs)
View(DATA[DATA$Crossoverstudy==1,c("Final_ID_all","Drug_name","SleepTimeTotalScaleMean", "SleepTimeTotalScaleSD","SleepTimeTotalScaleParticipants","tst_PorF-value","tst_p=0, f=1")])
DPs[DPs$Crossoverstudy==1,"studlab"]
DPs <- subset(DATApairs, treat2!="waitlist" & treat2!="artificial juice" & treat2!="sleep hygiene" & treat2!="oxazepam")
#check p-value availability for paired t-test
DPs[,c("studlab","tst_PorF-value","tst_p=0, f=1")][DPs$Crossoverstudy==1,]
#remove crossover studies with paired t-test p-value not available
DPs <- DPs[DPs$studlab!=161,]
# use threshold value for those with p-value <0.001
DPs[DPs$studlab==185, "tst_PorF-value"] <- 0.00099
#now calculate adjusted SE for remaining crossover studies
DPs$tvalue <- qt(as.numeric(DPs$`tst_PorF-value`), df=DPs$n1-1, lower.tail = F)
DPs$SDd <- abs((DPs$mean2-DPs$mean1)/DPs$tvalue*sqrt(DPs$n1))
DPs$rho <- (DPs$sd1^2 + DPs$sd2^2 - DPs$SDd^2)/(2*DPs$sd1*DPs$sd2)
DPs[DPs$Crossoverstudy==1,"seTE"] <- sqrt((1/DPs$n1 + DPs$TE/(2*DPs$n1))*(2-2*DPs$rho))[DPs$Crossoverstudy==1]
EFF<-netmeta(TE,seTE,treat1,treat2,studlab,data=DPs,  sm="SMD",r="pbo",comb.fixed =F, comb.random = T, tol.multiarm = 0.05, details.chkmultiarm = T)    ### gives error

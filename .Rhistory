DPs <- DATApairs[-grep("hygiene|Mindfulness|juice",DATApairs$treat1),]
# remove studies with "special patients" that should not be included in main analysis
DPs <- DPs[DPs$Included==1,]
#check p-value availability for paired t-test for crossover studies with both phases used
DPs[DPs$Crossoverstudy==1 & DPs$`crossover, not first phase used`==1,c("studlab","tst_PorF-value","tst_p=0, f=1")]
# use threshold value for those with p-value <0.001
DPs[DPs$studlab=="Vinkari 1984", "tst_PorF-value"] <- 0.00099
# now calculate adjusted SE for remaining crossover studies
DPs$tvalue <- qt(as.numeric(DPs$`squal_PorF-value`)/2, df=DPs$n1-1, lower.tail = F)
DPs$SDd <- abs((DPs$mean2-DPs$mean1)/DPs$tvalue*sqrt(DPs$n1))
DPs$rho <- (DPs$sd1^2 + DPs$sd2^2 - DPs$SDd^2)/(2*DPs$sd1*DPs$sd2)
DPs[DPs$Crossoverstudy==1 & DPs$`crossover, not first phase used`==1,"seTE"] <- sqrt((1/DPs$n1+(DPs$TE^2)/(2*DPs$n1))*(2-2*DPs$rho))[DPs$Crossoverstudy==1 & DPs$`crossover, not first phase used`==1]
# check there is no NA is the data
DPs[is.na(DPs$TE) | is.na(DPs$seTE),c("studlab","treat1","treat2","TE","seTE")]
DPs[DPs$Crossoverstudy==1 & DPs$`crossover, not first phase used`==1,"seTE"] <- sqrt((1/DPs$n1+(DPs$TE^2)/(2*DPs$n1))*(2-2*DPs$rho))[DPs$Crossoverstudy==1 & DPs$`crossover, not first phase used`==1]
# check there is no NA is the data
DPs[is.na(DPs$TE) | is.na(DPs$seTE),c("studlab","treat1","treat2","TE","seTE")]
# use threshold value for those with p-value <0.001
DPs[DPs$studlab=="Vinkari 1984", "tst_PorF-value"] <- 0.00099
# now calculate adjusted SE for remaining crossover studies
DPs$tvalue <- qt(as.numeric(DPs$`squal_PorF-value`)/2, df=DPs$n1-1, lower.tail = F)
DPs$SDd <- abs((DPs$mean2-DPs$mean1)/DPs$tvalue*sqrt(DPs$n1))
DPs$rho <- (DPs$sd1^2 + DPs$sd2^2 - DPs$SDd^2)/(2*DPs$sd1*DPs$sd2)
DPs[DPs$Crossoverstudy==1 & DPs$`crossover, not first phase used`==1,"seTE"] <- sqrt((1/DPs$n1+(DPs$TE^2)/(2*DPs$n1))*(2-2*DPs$rho))[DPs$Crossoverstudy==1 & DPs$`crossover, not first phase used`==1]
View(DPs)
DPs$rho
DPs$tvalue
#get the data and select them
DATA <- read_excel("~/Virginia/NMA insomnia/Insomnia/MyrtoIncludedAllOutcomesClean27.6dVirgiRenamedInterventions.xlsx", na = "NA")
# prepare the data
DATApairs=pairwise(treat=Drug_name, mean=SleepOnsetLatencyScaleMean, sd=SleepOnsetLatencyScaleSD, n=SleepOnsetLatencyScaleParticipants, data=DATA, studlab = Study_name, sm= "MD")
# run netconnection first to check for potential sub-networks
netconnection(treat1,treat2,studlab,data=DATApairs,warn = T)
#remove rows for studies disconnected from main network
DPs <- DATApairs[-grep("LAT|MAT|BBT I|flunitrazepam|juice",DATApairs$treat1),]
#check p-value availability for paired t-test for crossover studies with both phases used
DPs[DPs$Crossoverstudy==1 & DPs$`crossover, not first phase used`==1,c("studlab","sol_PorF-value","sol_p=0, f=1")]
#get the data and select them
DATA <- read_excel("~/Virginia/NMA insomnia/Insomnia/MyrtoIncludedAllOutcomesClean27.6dVirgiRenamedInterventions.xlsx", na = "NA")
# prepare the data
DATApairs=pairwise(treat=Drug_name, mean=SleepOnsetLatencyScaleMean, sd=SleepOnsetLatencyScaleSD, n=SleepOnsetLatencyScaleParticipants, data=DATA, studlab = Study_name, sm= "MD")
#remove rows for studies disconnected from main network
DPs <- DATApairs[-grep("LAT|MAT|BBT I|flunitrazepam|juice",DATApairs$treat1),]
#check p-value availability for paired t-test for crossover studies with both phases used
DPs[DPs$Crossoverstudy==1 & DPs$`crossover, not first phase used`==1,c("studlab","sol_PorF-value","sol_p=0, f=1")]
#check p-value availability for paired t-test for crossover studies with both phases used
DATA[DATA$Crossoverstudy==1 & DATA$`crossover, not first phase used`==1,c("studlab","sol_PorF-value","sol_p=0, f=1")]
#check p-value availability for paired t-test for crossover studies with both phases used
DATA[DATA$Crossoverstudy==1 & DATA$`crossover, not first phase used`==1,c("Study_name","sol_PorF-value","sol_p=0, f=1")]
View(DPs)
View(DATA)
View(DATApairs)
DPs$`sol_PorF-value1`
DPs$`sol_PorF-value2`
View(DPs)
#get the data and select them
DATA <- read_excel("~/Virginia/NMA insomnia/Insomnia/MyrtoIncludedAllOutcomesClean27.6dVirgiRenamedInterventions.xlsx", na = "NA")
# prepare the data
DATApairs=pairwise(treat=Drug_name, mean=SleepOnsetLatencyScaleMean, sd=SleepOnsetLatencyScaleSD, n=SleepOnsetLatencyScaleParticipants, data=DATA, studlab = Study_name, sm= "MD")
#remove rows for studies disconnected from main network
DPs <- DATApairs[-grep("LAT|MAT|BBT I|flunitrazepam|juice",DATApairs$treat1),]
#check p-value availability for paired t-test for crossover studies with both phases used
DATA[DATA$Crossoverstudy==1 & DATA$`crossover, not first phase used`==1,c("Study_name","sol_PorF-value","sol_p=0, f=1")]
# use threshold value for those with p-value <0.001
DPs[DPs$studlab=="Vinkari 1984", "tst_PorF-value"] <- 0.00099
#check p-value availability for paired t-test for crossover studies with both phases used
DPs[DPs$Crossoverstudy==1 & DPs$`crossover, not first phase used`==1,c("Study_name","sol_PorF-value","sol_p=0, f=1")]
DPs[DPs$Crossoverstudy==1 & DPs$`crossover, not first phase used`==1,c("Study_name","sol_PorF-value1", "sol_PorF-value2","sol_p=0, f=1")]
#check p-value availability for paired t-test for crossover studies with both phases used
DPs[DPs$Crossoverstudy==1 & DPs$`crossover, not first phase used`==1,c("Study_name",,"treat1","treat2","sol_PorF-value1","sol_PorF-value2","sol_p=0, f=1")]
#check p-value availability for paired t-test for crossover studies with both phases used
DPs[DPs$Crossoverstudy==1 & DPs$`crossover, not first phase used`==1,c("Study_name","treat1","treat2","sol_PorF-value1","sol_PorF-value2","sol_p=0, f=1")]
# use threshold value for those with p-value <0.001
DPs[DPs$studlab=="Vinkari 1984", "sol_PorF-value1"] <- 0.00099
# remove studies wit no p-value
DPs <- DPs[DPs$studlab!="Baskett 2003" & DPs$studlab!="Haimov 1995",]
#now calculate adjusted SE for remaining crossover studies
DPs$tvalue <- qt(as.numeric(DPs$`tst_PorF-value`)/2, df=DPs$n1-1, lower.tail = F)
#DPs$SDd <- abs((DPs$mean2-DPs$mean1)/DPs$tvalue*sqrt(DPs$n1))
#DPs$rho <- (DPs$sd1^2 + DPs$sd2^2 - DPs$SDd^2)/(2*DPs$sd1*DPs$sd2)
DPs[DPs$Crossoverstudy==1 & DPs$`crossover, not first phase used`==1,"seTE"] <- (abs(DPs$TE)/DPs$tvalue)[DPs$Crossoverstudy==1 & DPs$`crossover, not first phase used`==1]
# assign correlation value to study 18 and 185 based on other studies to fix issues with negative variances
DPs$rho <- 0.9
DPs$SDd <- sqrt(DPs$sd1^2 + DPs$sd2^2 - 2*DPs$rho*DPs$sd1*DPs$sd2)
# check there is no NA is the data
DPs[is.na(DPs$TE) | is.na(DPs$seTE),c("studlab","treat1","treat2","TE","seTE")]
DPs <- subset(DPs, studlab!="Glind 2014" & studlab!="Ancoli-Israel 1999" )
SOL<-netmeta(TE,seTE,treat1,treat2,studlab,data=DPs,  sm="MD",r="pbo",comb.fixed =F, comb.random = T, tol.multiarm = 0.5)
DPs[DPs$studlab=="Glass 2008" | DPs$studlab=="Vinkari 1984","seTE"] <- (DPs$SDd/sqrt(DPs$n1))[DPs$studlab=="Glass 2008" | DPs$studlab=="Vinkari 1984"]
SOL<-netmeta(TE,seTE,treat1,treat2,studlab,data=DPs,  sm="MD",r="pbo",comb.fixed =F, comb.random = T, tol.multiarm = 0.5)
#network plot
netgraph(SOL, plastic=F, thickness="number.of.studies", multiarm = F, points=T, col=1, number.of.studies=T)
#forest plots
forest(SOL, ref="pbo", sortvar = -Pscore,xlab="MD")
#get the data and select them
DATA <- read_excel("~/Virginia/NMA insomnia/Insomnia/MyrtoIncludedAllOutcomesClean27.6dVirgiRenamedInterventions.xlsx", na = "NA")
# prepare the data
DATApairs=pairwise(treat=Drug_name, mean=WakeAfterSleepOnsetScaleMean, sd=WakeAfterSleepOnsetScaleSD, n=WakeAfterSleepOnsetScaleParticipants, data=DATA, studlab = Study_name, sm= "MD")
#remove rows for studies disconnected from main network
DPs <- DATApairs[-grep("LAT|MAT|BBT I|juice",DATApairs$treat1),]
#check p-value availability for paired t-test for crossover studies with both phases used
DPs[DPs$Crossoverstudy==1 & DPs$`crossover, not first phase used`==1,c("studlab","waso_PorF-value","waso_p=0, f=1")]
# use threshold value for those with p-value <0.001
DPs[DPs$studlab=="Garfinkel 1995", "waso_PorF-value"] <- 0.00099
#now calculate adjusted SE for crossover studies
DPs$tvalue <- qt(as.numeric(DPs$`tst_PorF-value`)/2, df=DPs$n1-1, lower.tail = F)
#DPs$SDd <- abs((DPs$mean2-DPs$mean1)/DPs$tvalue*sqrt(DPs$n1))
#DPs$rho <- (DPs$sd1^2 + DPs$sd2^2 - DPs$SDd^2)/(2*DPs$sd1*DPs$sd2)
DPs[DPs$Crossoverstudy==1 & DPs$`crossover, not first phase used`==1,"seTE"] <- (abs(DPs$TE)/DPs$tvalue)[DPs$Crossoverstudy==1 & DPs$`crossover, not first phase used`==1]
# check there is no NA is the data
DPs[is.na(DPs$TE) | is.na(DPs$seTE),c("studlab","treat1","treat2","TE","seTE")]
WASO<-netmeta(TE,seTE,treat1,treat2,studlab,data=DPs,  sm="MD",r="pbo",comb.fixed =F, comb.random = T)
#network plot
netgraph(WASO, plastic=F, thickness="number.of.studies", multiarm = F, points=T, col=1, number.of.studies=T)
#forest plots
forest(WASO, ref="pbo", sortvar = -Pscore,xlab="MD")
#get the data and select them
DATA <- read_excel("~/Virginia/NMA insomnia/Insomnia/MyrtoIncludedAllOutcomesClean27.6dVirgiRenamedInterventions.xlsx", na = "NA")
# prepare the data
DATApairs=pairwise(treat=Drug_name, mean=DayTimeSleepinessScaleMean, sd=DayTimeSleepinessScaleSD, n=DayTimeSleepinessScaleParticipants, data=DATA, studlab = Study_name, sm= "SMD")
# run netconnection first to check for potential sub-networks
netconnection(treat1,treat2,studlab,data=DATApairs,warn = T)
# prepare the data
DATApairs=pairwise(treat=Drug_name, mean=DayTimeSleepinessScaleMean, sd=DayTimeSleepinessScaleSD, n=DayTimeSleepinessScaleParticipants, data=DATA, studlab = Study_name, sm= "SMD")
# run netconnection first to check for potential sub-networks
netconnection(treat1,treat2,studlab,data=DATApairs,warn = T)
#remove rows for studies disconnected from main network
DPs <- DATApairs[-grep("hygiene|Mindfulness|juice",DATApairs$treat1),]
# remove studies with "special patients" that should not be included in main analysis
DPs <- DPs[DPs$Included==1,]
#check p-value availability for paired t-test for crossover studies with both phases used
DPs[DPs$Crossoverstudy==1 & DPs$`crossover, not first phase used`==1,c("studlab","Day_PorF-value","Day_p=0, f=1")]
View(DPs)
# remove studies wit no p-value
DPs <- DPs[DPs$studlab!="Vinkari 1984",]
#check p-value availability for paired t-test for crossover studies with both phases used
DPs[DPs$Crossoverstudy==1 & DPs$`crossover, not first phase used`==1,c("studlab","Day_PorF-value","Day_p=0, f=1")]
# check there is no NA is the data
DPs[is.na(DPs$TE) | is.na(DPs$seTE),c("studlab","treat1","treat2","TE","seTE")]
DPs <- subset(DPs, studlab!="McCall 2006")
# run netconnection first to check for potential sub-networks
netconnection(treat1,treat2,studlab,data=DATApairs,warn = T)
#remove rows for studies disconnected from main network
DPs <- DATApairs[-grep("hygiene|Mindfulness|juice",DATApairs$treat1),]
# remove studies with "special patients" that should not be included in main analysis
DPs <- DPs[DPs$Included==1,]
#check p-value availability for paired t-test for crossover studies with both phases used
DPs[DPs$Crossoverstudy==1 & DPs$`crossover, not first phase used`==1,c("studlab","Day_PorF-value","Day_p=0, f=1")]
# remove studies wit no p-value
DPs <- DPs[DPs$studlab!="Vinkari 1984",]
# check there is no NA is the data
DPs[is.na(DPs$TE) | is.na(DPs$seTE),c("studlab","treat1","treat2","TE","seTE")]
DPs <- subset(DPs, studlab!="McCall 2006")
# check connection again to divide two sub-networks
netconnection(treat1,treat2,studlab,data=DPs,warn = T)
View(DPs)
DPs1 <- DPs[-grep("chlormethiazole|triazolam|loprazolam|nitrazepam|zopiclone",DPs$treat2),]
SQ1<-netmeta(TE,seTE,treat1,treat2,studlab,data=DPs1, sm="SMD",r="pbo",comb.fixed =F, comb.random = T)
rm(SQ1)
View(DATApairs)
#network plot
netgraph(DI1, plastic=F, thickness="number.of.studies", multiarm = F, points=T, col=1, number.of.studies=T)
DI1<-netmeta(TE,seTE,treat1,treat2,studlab,data=DPs1, sm="SMD",r="pbo",comb.fixed =F, comb.random = T)
DI1$trts
DI1$n
DI1$k
#network plot
netgraph(DI1, plastic=F, thickness="number.of.studies", multiarm = F, points=T, col=1, number.of.studies=T)
#forest plots
forest(DI1, ref="pbo", sortvar = -Pscore,xlab="MD")
cat(paste("tau=",round(DI1$tau,3)))
cat(paste("I2=",round(DI1$I2, digits = 2)*100,"%"))
split=netsplit(DI1)
SIDEp=split$compare.random$p
SIDEp=SIDEp[!is.na(SIDEp)]
#proportion of inconsistent loops
cat(length(SIDEp))
cat(length(SIDEp[SIDEp<=0.1]))
cat(paste(round((length(SIDEp[SIDEp<=0.1])/length(SIDEp))*100,1),"%"))
a=decomp.design(DI1)
print(round(a$Q.inc.random$pval,3))
View(DPs)
DI2 <- netmeta(TE,seTE,treat1,treat2,studlab,data=DPs, subset = grep("chlormethiazole|loprazolam|nitrazepam",DPs$treat1), sm="SMD",r="chlormethiazole",comb.fixed =T, comb.random = F)
DI2$trts
DI2$n
DI2$k
#network plot
netgraph(DI2, plastic=F, thickness="number.of.studies", multiarm = F, points=T, col=1)
#forest plots
forest(DI2, ref="chlormethiazole", sortvar = Pscore,xlab="SMD")
#forest plots
forest(DI2, ref="chlormethiazole", sortvar = -Pscore,xlab="SMD")
#forest plots
forest(DI2, ref="chlormethiazole", sortvar = Pscore,xlab="SMD")
#forest plots
forest(DI2, ref="chlormethiazole", sortvar = -Pscore,xlab="SMD")
cat(paste("tau=",round(DI2$tau,3)))
cat(paste("I2=",round(DI2$I2),"%"))
knitr::opts_chunk$set(echo = TRUE)
#get the data and select them
DATA <- read_excel("~/Virginia/NMA insomnia/Insomnia/MyrtoIncludedAllOutcomesClean27.6dVirgiRenamedInterventions.xlsx", na = "NA")
# prepare the data
DATApairs=pairwise(treat=Drug_name, mean=Qol_mean, sd=Qol_SD, n=Qol_participants, data=DATA, studlab = Study_name, sm= "SMD")
# prepare the data
DATApairs=pairwise(treat=Drug_name, mean=Qol_mean, sd=Qol_SD, n=QoL_participants, data=DATA, studlab = Study_name, sm= "SMD")
# run netconnection first to check for potential sub-networks
netconnection(treat1,treat2,studlab,data=DATApairs,warn = T)
View(DATApairs)
#remove rows for studies disconnected from main network
DPs <- DATApairs[-grep("LAT|MAT|acupressure",DATApairs$treat1),]
# remove studies with "special patients" that should not be included in main analysis
DPs <- DPs[DPs$Included==1,]
# prepare the data
DATApairs=pairwise(treat=Drug_name, mean=Qol_mean, sd=Qol_SD, n=QoL_participants, data=DATA, studlab = Study_name, sm= "SMD")
# run netconnection first to check for potential sub-networks
netconnection(treat1,treat2,studlab,data=DATApairs,warn = T)
#remove rows for studies disconnected from main network
DPs <- DATApairs[-grep("LAT|MAT|acupressure",DATApairs$treat1),]
# remove studies with "special patients" that should not be included in main analysis
DPs <- DPs[DPs$Included==1,]
View(DPs)
# check there is no NA is the data
DPs[is.na(DPs$TE) | is.na(DPs$seTE),c("studlab","treat1","treat2","TE","seTE")]
QOL<-netmeta(TE,seTE,treat1,treat2,studlab,data=DPs, sm="SMD",r="pbo",comb.fixed =F, comb.random = T)
DI1$n
QOL$n
QOL$k
#network plot
netgraph(QOL, plastic=F, thickness="number.of.studies", multiarm = F, points=T, col=1, number.of.studies=T)
#forest plots
forest(QOL, ref="pbo", sortvar = -Pscore,xlab="MD")
cat(paste("tau=",round(QOL$tau,3)))
cat(paste("I2=",round(QOL$I2, digits = 2)*100,"%"))
knitr::opts_chunk$set(echo = TRUE)
library(devtools)
install_github("esm-ispm-unibe-ch/NMAJags")
library(NMAJags)
library(R2jags)
library(netmeta)
library(meta)
library(metafor)
library(readxl)
#get the data and select them
DATA <- read_excel("~/Virginia/NMA insomnia/Insomnia/MyrtoIncludedAllOutcomesClean27.6dVirgiRenamedInterventions.xlsx", na = "NA")
# prepare the data
DATApairs=pairwise(treat=Drug_name, mean=PolySomnographyScaleMean, sd=PolySomnographyScaleSD, n=PolySomnographyScaleParticipants, data=DATA, studlab = Study_name, sm= "MD")
# run netconnection first to check for potential sub-networks
netconnection(treat1,treat2,studlab,data=DATApairs,warn = T)
#remove rows for studies disconnected from main network
DPs <- DATApairs[-grep("LAT|MAT|BBT I|",DATApairs$treat1),]
View(DPs)
#remove rows for studies disconnected from main network
DPs <- DATApairs[-grep("LAT|MAT|BBT I",DATApairs$treat1),]
View(DPs)
knitr::opts_chunk$set(echo = TRUE)
#get the data and select them
DATA <- read_excel("~/Virginia/NMA insomnia/Insomnia/MyrtoIncludedAllOutcomesClean27.6dVirgiRenamedInterventions.xlsx", na = "NA")
# prepare the data
DATApairs=pairwise(treat=Drug_name, mean=SleepOnsetLatencyScaleMean, sd=SleepOnsetLatencyScaleSD, n=SleepOnsetLatencyScaleParticipants, data=DATA, studlab = Study_name, sm= "MD")
# run netconnection first to check for potential sub-networks
netconnection(treat1,treat2,studlab,data=DATApairs,warn = T)
#remove rows for studies disconnected from main network
DPs <- DATApairs[-grep("LAT|MAT|BBT I|flunitrazepam|juice",DATApairs$treat1),]
View(DPs)
DPs$Included
#check p-value availability for paired t-test for crossover studies with both phases used
DPs[DPs$Crossoverstudy==1 & DPs$`crossover, not first phase used`==1,c("Study_name","treat1","treat2","sol_PorF-value1","sol_PorF-value2","sol_p=0, f=1")]
# use threshold value for those with p-value <0.001
DPs[DPs$studlab=="Vinkari 1984", "sol_PorF-value1"] <- 0.00099
#check p-value availability for paired t-test for crossover studies with both phases used
DPs[DPs$Crossoverstudy==1 & DPs$`crossover, not first phase used`==1,c("Study_name","treat1","treat2","sol_PorF-value1","sol_PorF-value2","sol_p=0, f=1")]
# remove studies wit no p-value
DPs <- DPs[DPs$studlab!="Baskett 2003" & DPs$studlab!="Haimov 1995",]
#now calculate adjusted SE for remaining crossover studies
DPs$tvalue <- qt(as.numeric(DPs$`sol_PorF-value`)/2, df=DPs$n1-1, lower.tail = F)
#now calculate adjusted SE for remaining crossover studies
DPs$tvalue <- qt(as.numeric(DPs$`sol_PorF-value1`)/2, df=DPs$n1-1, lower.tail = F)
#DPs$SDd <- abs((DPs$mean2-DPs$mean1)/DPs$tvalue*sqrt(DPs$n1))
#DPs$rho <- (DPs$sd1^2 + DPs$sd2^2 - DPs$SDd^2)/(2*DPs$sd1*DPs$sd2)
DPs[DPs$Crossoverstudy==1 & DPs$`crossover, not first phase used`==1,"seTE"] <- (abs(DPs$TE)/DPs$tvalue)[DPs$Crossoverstudy==1 & DPs$`crossover, not first phase used`==1]
# check there is no NA is the data
DPs[is.na(DPs$TE) | is.na(DPs$seTE),c("studlab","treat1","treat2","TE","seTE")]
DPs <- subset(DPs, studlab!="Glind 2014" & studlab!="Ancoli-Israel 1999" )
SOL<-netmeta(TE,seTE,treat1,treat2,studlab,data=DPs,  sm="MD",r="pbo",comb.fixed =F, comb.random = T, tol.multiarm = 0.5)
# assign correlation value to study 18 and 185 based on other studies to fix issues with negative variances
DPs$rho <- 0.9
DPs$SDd <- sqrt(DPs$sd1^2 + DPs$sd2^2 - 2*DPs$rho*DPs$sd1*DPs$sd2)
DPs[DPs$studlab=="Glass 2008" | DPs$studlab=="Vinkari 1984","seTE"] <- (DPs$SDd/sqrt(DPs$n1))[DPs$studlab=="Glass 2008" | DPs$studlab=="Vinkari 1984"]
View(DPs)
# prepare the data
DATApairs=pairwise(treat=Drug_name, mean=PolySomnographyScaleMean, sd=PolySomnographyScaleSD, n=PolySomnographyScaleParticipants, data=DATA, studlab = Study_name, sm= "MD")
# run netconnection first to check for potential sub-networks
netconnection(treat1,treat2,studlab,data=DATApairs,warn = T)
#remove rows for studies disconnected from main network
DPs <- DATApairs[-grep("LAT|MAT|BBT I",DATApairs$treat1),]
#check p-value availability for paired t-test for crossover studies with both phases used
DPs[DPs$Crossoverstudy==1 & DPs$`crossover, not first phase used`==1,c("Study_name","treat1","treat2","sol_PorF-value1","sol_PorF-value2","sol_p=0, f=1")]
#check p-value availability for paired t-test for crossover studies with both phases used
DPs[DPs$Crossoverstudy==1 & DPs$`crossover, not first phase used`==1,c("Study_name","treat1","treat2","sol_PorF-value1","sol_PorF-value2","sol_p=0, f=1")]
# prepare the data
DATApairs=pairwise(treat=Drug_name, mean=PolySomnographyScaleMean, sd=PolySomnographyScaleSD, n=PolySomnographyScaleParticipants, data=DATA, studlab = Study_name, sm= "MD")
#remove rows for studies disconnected from main network
DPs <- DATApairs[-grep("LAT|MAT|BBT I",DATApairs$treat1),]
# prepare the data
DATApairs=pairwise(treat=Drug_name, mean=SleepOnsetLatencyScaleMean, sd=SleepOnsetLatencyScaleSD, n=SleepOnsetLatencyScaleParticipants, data=DATA, studlab = Study_name, sm= "MD")
# run netconnection first to check for potential sub-networks
netconnection(treat1,treat2,studlab,data=DATApairs,warn = T)
#remove rows for studies disconnected from main network
DPs <- DATApairs[-grep("LAT|MAT|BBT I|flunitrazepam|juice",DATApairs$treat1),]
#check p-value availability for paired t-test for crossover studies with both phases used
DPs[DPs$Crossoverstudy==1 & DPs$`crossover, not first phase used`==1,c("Study_name","treat1","treat2","sol_PorF-value1","sol_PorF-value2","sol_p=0, f=1")]
# use threshold value for those with p-value <0.001
DPs[DPs$studlab=="Vinkari 1984", "sol_PorF-value1"] <- 0.00099
# remove studies wit no p-value
DPs <- DPs[DPs$studlab!="Baskett 2003" & DPs$studlab!="Haimov 1995",]
#now calculate adjusted SE for remaining crossover studies
DPs$tvalue <- qt(as.numeric(DPs$`sol_PorF-value1`)/2, df=DPs$n1-1, lower.tail = F)
#DPs$SDd <- abs((DPs$mean2-DPs$mean1)/DPs$tvalue*sqrt(DPs$n1))
#DPs$rho <- (DPs$sd1^2 + DPs$sd2^2 - DPs$SDd^2)/(2*DPs$sd1*DPs$sd2)
DPs[DPs$Crossoverstudy==1 & DPs$`crossover, not first phase used`==1,"seTE"] <- (abs(DPs$TE)/DPs$tvalue)[DPs$Crossoverstudy==1 & DPs$`crossover, not first phase used`==1]
# assign correlation value to study 18 and 185 based on other studies to fix issues with negative variances
DPs$rho <- 0.9
DPs$SDd <- sqrt(DPs$sd1^2 + DPs$sd2^2 - 2*DPs$rho*DPs$sd1*DPs$sd2)
DPs[DPs$studlab=="Glass 2008" | DPs$studlab=="Vinkari 1984","seTE"] <- (DPs$SDd/sqrt(DPs$n1))[DPs$studlab=="Glass 2008" | DPs$studlab=="Vinkari 1984"]
# check there is no NA is the data
DPs[is.na(DPs$TE) | is.na(DPs$seTE),c("studlab","treat1","treat2","TE","seTE")]
DPs <- subset(DPs, studlab!="Glind 2014" & studlab!="Ancoli-Israel 1999" )
SOL<-netmeta(TE,seTE,treat1,treat2,studlab,data=DPs,  sm="MD",r="pbo",comb.fixed =F, comb.random = T, tol.multiarm = 0.5)
knitr::opts_chunk$set(echo = TRUE)
# prepare the data
DATApairs=pairwise(treat=Drug_name, mean=WakeAfterSleepOnsetScaleMean, sd=WakeAfterSleepOnsetScaleSD, n=WakeAfterSleepOnsetScaleParticipants, data=DATA, studlab = Study_name, sm= "MD")
# run netconnection first to check for potential sub-networks
netconnection(treat1,treat2,studlab,data=DATApairs,warn = T)
#remove rows for studies disconnected from main network
DPs <- DATApairs[-grep("LAT|MAT|BBT I|juice",DATApairs$treat1),]
DPs$Included
#check p-value availability for paired t-test for crossover studies with both phases used
DPs[DPs$Crossoverstudy==1 & DPs$`crossover, not first phase used`==1,c("studlab","waso_PorF-value","waso_p=0, f=1")]
# use threshold value for those with p-value <0.001
DPs[DPs$studlab=="Garfinkel 1995", "waso_PorF-value"] <- 0.00099
#remove rows for studies disconnected from main network
DPs <- DATApairs[-grep("LAT|MAT|BBT I|juice",DATApairs$treat1),]
#check p-value availability for paired t-test for crossover studies with both phases used
DPs[DPs$Crossoverstudy==1 & DPs$`crossover, not first phase used`==1,c("studlab","waso_PorF-value","waso_p=0, f=1")]
# use threshold value for those with p-value <0.001
DPs[DPs$studlab=="Garfinkel 1995", "waso_PorF-value"] <- 0.00099
#now calculate adjusted SE for crossover studies
DPs$tvalue <- qt(as.numeric(DPs$`waso_PorF-value`)/2, df=DPs$n1-1, lower.tail = F)
#DPs$SDd <- abs((DPs$mean2-DPs$mean1)/DPs$tvalue*sqrt(DPs$n1))
#DPs$rho <- (DPs$sd1^2 + DPs$sd2^2 - DPs$SDd^2)/(2*DPs$sd1*DPs$sd2)
DPs[DPs$Crossoverstudy==1 & DPs$`crossover, not first phase used`==1,"seTE"] <- (abs(DPs$TE)/DPs$tvalue)[DPs$Crossoverstudy==1 & DPs$`crossover, not first phase used`==1]
# check there is no NA is the data
DPs[is.na(DPs$TE) | is.na(DPs$seTE),c("studlab","treat1","treat2","TE","seTE")]
WASO<-netmeta(TE,seTE,treat1,treat2,studlab,data=DPs,  sm="MD",r="pbo",comb.fixed =F, comb.random = T)
# prepare the data
DATApairs=pairwise(treat=Drug_name, mean=PolySomnographyScaleMean, sd=PolySomnographyScaleSD, n=PolySomnographyScaleParticipants, data=DATA, studlab = Study_name, sm= "MD")
# run netconnection first to check for potential sub-networks
netconnection(treat1,treat2,studlab,data=DATApairs,warn = T)
#remove rows for studies disconnected from main network
DPs <- DATApairs[-grep("LAT|MAT|BBT I",DATApairs$treat1),]
#remove rows for studies disconnected from main network
DPs <- DATApairs[-grep("LAT|MAT|BBT I",DATApairs$treat1),]
#check p-value availability for paired t-test for crossover studies with both phases used
DPs[DPs$Crossoverstudy==1 & DPs$`crossover, not first phase used`==1,c("Study_name","treat1","treat2","sol_PorF-value1","sol_PorF-value2","sol_p=0, f=1")]
#check p-value availability for paired t-test for crossover studies with both phases used
DPs[DPs$Crossoverstudy==1 & DPs$`crossover, not first phase used`==1,c("Study_name","treat1","treat2")]
so
# no p-value available for this outcome so remove crossover study
DPs <- DPs[DPs$studlab!="Garfinkel 1995",]
# check there is no NA is the data
DPs[is.na(DPs$TE) | is.na(DPs$seTE),c("studlab","treat1","treat2","TE","seTE")]
polyTST<-netmeta(TE,seTE,treat1,treat2,studlab,data=DPs,  sm="MD",r="pbo",comb.fixed =F, comb.random = T)
polyTST$n
polyTST$k
#network plot
netgraph(polyTST, plastic=F, thickness="number.of.studies", multiarm = F, points=T, col=1, number.of.studies=T)
#forest plots
forest(polyTST, ref="pbo", sortvar = -Pscore,xlab="MD")
#forest plots
forest(polyTST, ref="pbo", sortvar = Pscore,xlab="MD")
cat(paste("tau=",round(polyTST$tau,3)))
cat(paste("I2=",round(polyTST$I2, digits = 2)*100,"%"))
knitr::opts_chunk$set(echo = TRUE)
#get the data and select them
DATA <- read_excel("~/Virginia/NMA insomnia/Insomnia/MyrtoIncludedAllOutcomesClean27.6dVirgiRenamedInterventions.xlsx", na = "NA")
#prepare the data
DATApairs=pairwise(treat=Drug_name,mean=NocturnalAwakeningsScaleMean,sd=NocturnalAwakeningsScaleSD,n=NocturnalAwakeningsScaleParticipants, data=DATA, studlab = Study_name, sm= "MD")
#prepare the data
DATApairs=pairwise(treat=Drug_name,mean=NocturnalAwakeningsScaleMean,sd=NocturnalAwakeningsScaleSD,n=NocturnalAwakeningsScaleParticipants, data=DATA, studlab = Study_name, sm= "MD")
#run NMA and create an object called EFF for efficacy   ### gives error because consists of 5 separate sub-networks so run netconnection first
netconnection(treat1,treat2,studlab,data=DATApairs,warn = T)
#remove rows for studies disconnected from main network
DPs <- DATApairs[-grep("BBT I|hygiene",DATApairs$treat1),]
DPs$Included
#check p-value availability for paired t-test for crossover studies with both phases used
DPs[DPs$Crossoverstudy==1 & DPs$`crossover, not first phase used`==1,c("studlab","Awak_PorF-value","Awak_p=0, f=1")]
# use threshold value for those with p-value <0.001
DPs[DPs$studlab=="Glass 2008", "Awak_PorF-value"] <- 0.00099
#now calculate adjusted SE for remaining crossover studies
DPs$tvalue <- qt(as.numeric(DPs$`Awak_PorF-value`)/2, df=DPs$n1-1, lower.tail = F)
#prepare the data
DATApairs=pairwise(treat=Drug_name,mean=NocturnalAwakeningsScaleMean,sd=NocturnalAwakeningsScaleSD,n=NocturnalAwakeningsScaleParticipants, data=DATA, studlab = Study_name, sm= "MD")
#run NMA and create an object called EFF for efficacy   ### gives error because consists of 5 separate sub-networks so run netconnection first
netconnection(treat1,treat2,studlab,data=DATApairs,warn = T)
#remove rows for studies disconnected from main network
DPs <- DATApairs[-grep("BBT I|hygiene",DATApairs$treat1),]
#check p-value availability for paired t-test for crossover studies with both phases used
DPs[DPs$Crossoverstudy==1 & DPs$`crossover, not first phase used`==1,c("studlab","Awak_PorF-value","Awak_p=0, f=1")]
# use threshold value for those with p-value <0.001
DPs[DPs$studlab=="Glass 2008", "Awak_PorF-value"] <- 0.00099
#now calculate adjusted SE for remaining crossover studies
DPs$tvalue <- qt(as.numeric(DPs$`Awak_PorF-value`)/2, df=DPs$n1-1, lower.tail = F)
#DPs$SDd <- abs((DPs$mean2-DPs$mean1)/DPs$tvalue*sqrt(DPs$n1))
#DPs$rho <- (DPs$sd1^2 + DPs$sd2^2 - DPs$SDd^2)/(2*DPs$sd1*DPs$sd2)
DPs[DPs$Crossoverstudy==1 & DPs$`crossover, not first phase used`==1,"seTE"] <- (abs(DPs$TE)/DPs$tvalue)[DPs$Crossoverstudy==1 & DPs$`crossover, not first phase used`==1]
NNA<-netmeta(TE,seTE,treat1,treat2,studlab,data=DPs,  sm="MD",r="pbo",comb.fixed =F, comb.random = T, tol.multiarm = 0.5)
NNA<-netmeta(TE,seTE,treat1,treat2,studlab,data=DPs,  sm="MD",r="pbo",comb.fixed =F, comb.random = T, details.chkmultiarm = T)
# assign correlation value to study 18 and 185 based on other studies to fix issues with negative variances
DPs$rho <- 0.9
DPs$SDd <- sqrt(DPs$sd1^2 + DPs$sd2^2 - 2*DPs$rho*DPs$sd1*DPs$sd2)
DPs[DPs$studlab=="Glass 2008","seTE"] <- (DPs$SDd/sqrt(DPs$n1))[DPs$studlab=="Glass 2008"]
NNA<-netmeta(TE,seTE,treat1,treat2,studlab,data=DPs,  sm="MD",r="pbo",comb.fixed =F, comb.random = T)
NNA$n
NNA$k
#network plot
netgraph(NNA, plastic=F, thickness="number.of.studies", multiarm = F, points=T, col=1, number.of.studies=T)
#forest plots
forest(NNA, ref="pbo", sortvar = -Pscore,xlab="MD")
cat(paste("tau=",round(NNA$tau,3)))
cat(paste("I2=",round(NNA$I2, digits = 2)*100,"%"))
#only non-crossover
InsoNNAsen=subset(DPs,Crossoverstudy==0 | Crossoverstudy==1 & `crossover, not first phase used`!=1)
netconnection(treat1,treat2,studlab,data=InsoNNAsen,warn = T)
NNAsens<-netmeta(TE,seTE,treat1,treat2,studlab,data=InsoTSTsen,  sm="MD",comb.fixed =F, comb.random = T)
NNAsens<-netmeta(TE,seTE,treat1,treat2,studlab,data=InsoNNAsen,  sm="MD",comb.fixed =F, comb.random = T)
#network plot
netgraph(NNAsens, plastic=F, thickness="number.of.studies", multiarm = F, points=T, col=1, number.of.studies=T)
forest(NNAsens, ref="pbo",sortvar = -Pscore, smlab="Only parallel studies", fontsize=10,xlab="MD")
knitr::opts_chunk$set(echo = TRUE)
library(devtools)
install_github("esm-ispm-unibe-ch/NMAJags")
library(NMAJags)
library(R2jags)
library(netmeta)
library(meta)
library(metafor)
library(readxl)
#get the data and select them
DATA <- read_excel("~/Virginia/NMA insomnia/Insomnia/MyrtoIncludedAllOutcomesClean27.6dVirgiRenamedInterventions.xlsx", na = "NA")
#prepare the data
DATApairs=pairwise(treat=Drug_name, event=TotalParticipantsAE, n=`N_arm_total_for sideeffects`, data=DATA, studlab = Study_name, sm= "OR")
#run NMA and create an object called EFF for efficacy   ### gives error because consists of 5 separate sub-networks so run netconnection first
netconnection(treat1,treat2,studlab,data=DATApairs,warn = T)
#run NMA and create an object called EFF for efficacy   ### gives error because consists of 5 separate sub-networks so run netconnection first
netconnection(treat1,treat2,studlab,data=DATApairs,warn = T)
#remove rows for studies disconnected from main network
DPs <- DATApairs[-grep("LAT|MAT|BBT I|Mindfulness|midazolam|hygiene|juice|acupressure|acupuncture",DATApairs$treat1),]
# remove studies with "special patients" that should not be included in main analysis
DPs <- DPs[DPs$Included==1,]
#remove rows for studies disconnected from main network
DPs <- DATApairs[-grep("LAT|MAT|BBT I|Mindfulness|midazolam|hygiene|juice|acupressure|acupuncture",DATApairs$treat1),]
DPs$Included
# remove interventions disconnected to main network (also have NA TE and seTE)
DPs <- DPs[-grep("massage|therapeutic",DPs$treat2),]
DPs$Included
# remove studies with "special patients" that should not be included in main analysis
DPs <- DPs[DPs$Included==1,]
knitr::opts_chunk$set(echo = TRUE)
#get the data and select them
DATA <- read_excel("~/Virginia/NMA insomnia/Insomnia/MyrtoIncludedAllOutcomesClean27.6dVirgiRenamedInterventions.xlsx", na = "NA")
#prepare the data
DATApairs=pairwise(treat=Drug_name,mean=NocturnalAwakeningsScaleMean,sd=NocturnalAwakeningsScaleSD,n=NocturnalAwakeningsScaleParticipants, data=DATA, studlab = Study_name, sm= "MD")
#remove rows for studies disconnected from main network
DPs <- DATApairs[-grep("BBT I|hygiene",DATApairs$treat1),]
DPs$Included
knitr::opts_chunk$set(echo = TRUE)
# prepare the data
DATApairs=pairwise(treat=Drug_name, mean=PolySomnographyScaleMean, sd=PolySomnographyScaleSD, n=PolySomnographyScaleParticipants, data=DATA, studlab = Study_name, sm= "MD")
#remove rows for studies disconnected from main network
DPs <- DATApairs[-grep("LAT|MAT|BBT I",DATApairs$treat1),]
DPs$Included
knitr::opts_chunk$set(echo = TRUE)
# prepare the data
DATApairs=pairwise(treat=Drug_name, mean=Qol_mean, sd=Qol_SD, n=QoL_participants, data=DATA, studlab = Study_name, sm= "SMD")
#remove rows for studies disconnected from main network
DPs <- DATApairs[-grep("LAT|MAT|acupressure",DATApairs$treat1),]
DPs$Included
knitr::opts_chunk$set(echo = TRUE)
# prepare the data
DATApairs=pairwise(treat=Drug_name, mean=WakeAfterSleepOnsetScaleMean, sd=WakeAfterSleepOnsetScaleSD, n=WakeAfterSleepOnsetScaleParticipants, data=DATA, studlab = Study_name, sm= "MD")
#remove rows for studies disconnected from main network
DPs <- DATApairs[-grep("LAT|MAT|BBT I|juice",DATApairs$treat1),]
DPs$Included
knitr::opts_chunk$set(echo = TRUE)
#prepare the data
DATApairs=pairwise(treat=Drug_name,mean=SleepTimeTotalScaleMean,sd=SleepTimeTotalScaleSD,n=SleepTimeTotalScaleParticipants, data=DATA, studlab = Final_ID_all, sm= "MD")
#remove rows for studies disconnected from main network
DPs <- DATApairs[-grep("LAT|MAT|BBT I|midazolam|hygiene|juice",DATApairs$treat1),]
DPs$Included
knitr::opts_chunk$set(echo = TRUE)
#prepare the data
DATApairs=pairwise(treat=Drug_name,mean=SleepQualityScaleMean,sd=SleepQualityScaleSD,n=SleepQualityScaleParticipants, data=DATA, studlab = Final_ID_all, sm= "SMD")
#remove rows for studies disconnected from main network
DPs <- subset(DATApairs, treat1!="BBT I" & treat1!="auricular acupuncture")
DPs <- DPs[-grep("LAT|MAT|acupressure|waitlist|therapeutic|hygiene|juice",DPs$treat2),]
DPs$Included
knitr::opts_chunk$set(echo = TRUE)
# prepare the data
DATApairs=pairwise(treat=Drug_name, mean=SleepOnsetLatencyScaleMean, sd=SleepOnsetLatencyScaleSD, n=SleepOnsetLatencyScaleParticipants, data=DATA, studlab = Study_name, sm= "MD")
#remove rows for studies disconnected from main network
DPs <- DATApairs[-grep("LAT|MAT|BBT I|flunitrazepam|juice",DATApairs$treat1),]
DPs$Included
